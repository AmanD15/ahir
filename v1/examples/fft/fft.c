
#ifdef RUN
#include <stdio.h>
#include <math.h>
#endif

float x[129] =
    {
	0.000000, 0.024544, 0.049087, 0.073631, 0.098175
	, 0.122718, 0.147262, 0.171806, 0.196350, 0.220893
	, 0.245437, 0.269981, 0.294524, 0.319068, 0.343612
	, 0.368155, 0.392699, 0.417243, 0.441786, 0.466330
	, 0.490874, 0.515418, 0.539961, 0.564505, 0.589049
	, 0.613592, 0.638136, 0.662680, 0.687223, 0.711767
	, 0.736311, 0.760854, 0.785398, 0.809942, 0.834486
	, 0.859029, 0.883573, 0.908117, 0.932660, 0.957204
	, 0.981748, 1.006291, 1.030835, 1.055379, 1.079923
	, 1.104466, 1.129010, 1.153554, 1.178097, 1.202641
	, 1.227185, 1.251728, 1.276272, 1.300816, 1.325359
	, 1.349903, 1.374447, 1.398991, 1.423534, 1.448078
	, 1.472622, 1.497165, 1.521709, 1.546253, 1.570796
	, 1.595340, 1.619884, 1.644427, 1.668971, 1.693515
	, 1.718059, 1.742602, 1.767146, 1.791690, 1.816233
	, 1.840777, 1.865321, 1.889864, 1.914408, 1.938952
	, 1.963495, 1.988039, 2.012583, 2.037127, 2.061670
	, 2.086214, 2.110758, 2.135301, 2.159845, 2.184389
	, 2.208932, 2.233476, 2.258020, 2.282563, 2.307107
	, 2.331651, 2.356194, 2.380738, 2.405282, 2.429826
	, 2.454369, 2.478913, 2.503457, 2.528000, 2.552544
	, 2.577088, 2.601631, 2.626175, 2.650719, 2.675262
	, 2.699806, 2.724350, 2.748894, 2.773437, 2.797981
	, 2.822525, 2.847068, 2.871612, 2.896156, 2.920700
	, 2.945243, 2.969787, 2.994331, 3.018874, 3.043418
	, 3.067962, 3.092505, 3.117049, 3.141593
    };
    
float sine_lut[129] =
    {
	0.000000, 0.024541, 0.049068, 0.073565, 0.098017
	, 0.122411, 0.146730, 0.170962, 0.195090, 0.219101
	, 0.242980, 0.266713, 0.290285, 0.313682, 0.336890
	, 0.359895, 0.382683, 0.405241, 0.427555, 0.449611
	, 0.471397, 0.492898, 0.514103, 0.534998, 0.555570
	, 0.575808, 0.595699, 0.615232, 0.634393, 0.653173
	, 0.671559, 0.689541, 0.707107, 0.724247, 0.740951
	, 0.757209, 0.773010, 0.788346, 0.803208, 0.817585
	, 0.831470, 0.844854, 0.857729, 0.870087, 0.881921
	, 0.893224, 0.903989, 0.914210, 0.923880, 0.932993
	, 0.941544, 0.949528, 0.956940, 0.963776, 0.970031
	, 0.975702, 0.980785, 0.985278, 0.989177, 0.992480
	, 0.995185, 0.997290, 0.998795, 0.999699, 1.000000
	, 0.999699, 0.998795, 0.997290, 0.995185, 0.992480
	, 0.989176, 0.985278, 0.980785, 0.975702, 0.970031
	, 0.963776, 0.956940, 0.949528, 0.941544, 0.932993
	, 0.923880, 0.914210, 0.903989, 0.893224, 0.881921
	, 0.870087, 0.857729, 0.844854, 0.831470, 0.817585
	, 0.803207, 0.788346, 0.773010, 0.757209, 0.740951
	, 0.724247, 0.707107, 0.689540, 0.671559, 0.653173
	, 0.634393, 0.615231, 0.595699, 0.575808, 0.555570
	, 0.534997, 0.514103, 0.492898, 0.471397, 0.449611
	, 0.427555, 0.405241, 0.382683, 0.359895, 0.336890
	, 0.313682, 0.290285, 0.266713, 0.242980, 0.219101
	, 0.195090, 0.170962, 0.146730, 0.122411, 0.098017
	, 0.073564, 0.049067, 0.024541, 0.000000
    };

float
sine (float a)
{
  int i = 0, k = 1;
  int low, high;
  float rval = 0;
  float delta = 0.012272;
  
  if (a < 0) {
      a = 0 - a;
      k = -1;
  }

  while (a > (float) 6.283185)
      a = a - (float) 6.283185;

  if (a > (float) 3.141593) {
      k = -k;
      a = a - (float) 3.141593;
  }
  
  low = 0;
  high = 130;

  i = (low + high) >> 1;
  while (high - low > 1) {
      float curr = x[i];

      if (a > curr) {
	  if (a - curr <= delta)
	      break;
	  low = i;
      } else if (a < curr) {
	  if (curr - a <= delta)
	      break;
	  high = i;
      } else
	  break;

      i = (low + high) >> 1;
  }

  rval = sine_lut[i];

  return rval * k;
}

float divide(float N, float D)
{
    int sign = 1;
    float X;
    
    if (N < 0) {
	N = -N;
	sign = -sign;
    }

    if (D < 0) {
	D = -D;
	sign = -sign;
    }


    if (D > 0 ) {
      while (D < (float)0.5) {
	    D = 2 * D;
	    N = 2 * N;
	}

	while (D > 1) {
	    D = 0.5 * D;
	    N = 0.5 * N;
	}
    }

    X = (float)2.9142 - 2*D;

    X = X*(2 - D*X);
    X = X*(2 - D*X);
    X = X*(2 - D*X);
    X = X*(2 - D*X);

    return sign * X * N;
}


#define SWAP(a,b) tempr=(a);(a)=(b);(b)=tempr

float data[] = {
    0.0,
0.538471,0.029522,
0.412811,0.667218,
0.310332,0.115243,
-0.510124,-0.694889,
0.829681,0.595456,
0.637188,0.675081,
0.048222,-0.149378,
0.539140,-0.237120,
-0.531897,0.590373,
0.748371,-0.561075,
0.376182,-0.153885,
-0.594451,-0.846469,
0.920744,0.353673,
-0.416505,-0.898115,
0.711417,-0.320998,
-0.416338,0.892200,
-0.290200,0.341919,
0.098796,-0.664638,
0.659659,-0.586870,
0.512583,0.549414,
-0.218822,0.425960,
0.964757,0.755330,
-0.733020,0.900067,
-0.672892,0.013947,
0.438300,-0.794676,
-0.031459,0.159129,
-0.728113,0.779075,
0.097084,-0.949388,
0.390187,-0.431943,
0.288233,0.748861,
0.997258,0.895430,
-0.598618,-0.212614,
0.577160,-0.868738,
0.243595,0.338808,
-0.944226,0.670044,
0.201501,0.756819,
0.241924,-0.928935,
0.636739,-0.909638,
-0.080858,-0.902540,
-0.461272,0.494761,
-0.739872,-0.485166,
0.021746,0.674563,
-0.892017,0.266875,
-0.009745,0.820034,
-0.210888,0.820251,
0.554751,-0.966243,
0.573736,-0.101262,
0.148359,0.430416,
-0.801169,0.050023,
0.592622,0.760877,
0.433033,0.296366,
0.796449,0.074923,
-0.737717,-0.205001,
-0.646251,-0.024078,
0.367766,-0.243010,
-0.738434,-0.854963,
0.016146,-0.991203,
-0.822426,-0.962554,
0.381021,-0.739048,
-0.907861,-0.750030,
-0.326710,0.954493,
-0.135278,-0.696259,
-0.526915,-0.474850,
-0.396458,0.109671,
};

unsigned long nn = 64;
int isign = 1;
    
float start()
{
    unsigned long n,mmax,m,j,istep,i;
    float wtemp,wr,wpr,wpi,wi,theta;

    float tempr,tempi;

    n = nn << 1;
    j = 1;
    
    for (i = 1; i < n; i += 2) {
	if (j > i) {
	    SWAP(data[j],data[i]);
	    SWAP(data[j+1],data[i+1]);
	}
	
	m = n >> 1;
	while (m >= 2 && j > m) {
	    j -= m;
	    m >>= 1;
	}
	j += m;
    }

    mmax = 2;
    while (n > mmax) {
	istep = mmax << 1;
#ifdef ORIG
	theta = isign * ((float)6.283185 / mmax);
	wtemp = sin(0.5*theta);
	wpr = (float)-2.0*wtemp*wtemp;
	wpi = sin(theta);
#else
	theta = isign * divide((float)6.283185, mmax);
	wtemp = sine(0.5*theta);
	wpr = (float)-2.0*wtemp*wtemp;
	wpi = sine(theta);
#endif
	
	wr=1.0;
	wi=0.0;
	for (m=1;m<mmax;m+=2) {
	    for (i=m;i<=n;i+=istep) {
		j=i+mmax;
		tempr=wr*data[j]-wi*data[j+1];
		tempi=wr*data[j+1]+wi*data[j];
		data[j]=data[i]-tempr;
		data[j+1]=data[i+1]-tempi;
		data[i] += tempr;
		data[i+1] += tempi;
	    }
#ifdef ORIG
	    wr = (wtemp=wr)*wpr - wi*wpi + wr;
#else
	    wtemp = wr;
	    wr = wtemp*wpr - wi*wpi + wr;
#endif
	    wi = wi*wpr + wtemp*wpi + wi;
	}
	mmax = istep;
    }

    return data[nn + 2];
}

#ifdef RUN
int main (void)
{
    int i = 0;

    start(data, 8, 1);

    for (i = 1; i < 17; ++i) {
	printf("%f\n", data[i]);
    }

    printf("\n%f\n", data[63]);
    printf("%f\n", data[64]);
    printf("%f\n", data[65]);
    printf("%f\n", data[66]);
    
    printf("\n%f\n", data[127]);
    printf("%f\n", data[128]);
    printf("%f\n", data[129]);
    
    return 0;
}
#endif
